<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Events</title><link rel="stylesheet" href="ts3doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="up" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="prev" href="ar01s11.html" title="Channel and client manipulation"><link rel="next" href="ar01s12s01.html" title="Custom encryption"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><img id="logo" src="images/logo.png"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Events</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s11.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s12s01.html"><img src="images/next.png" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="s_callbacks"></a>Events</h2></div></div></div><p>The server lib will notify the server application about certain actions by sending events as callbacks. Callback function pointers needs to be initialized in <a class="link" href="ar01s04.html" title="Initializing"><code class="function">ts3server_initServerLib</code></a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Your callback implementations should exit quickly to avoid blocking the server. If you require to do lengthly operations, consider using a new thread to let the callback itself finish as soon as possible.</p></td></tr></table></div><p>All strings are UTF-8 encoded.</p><p>A client has connected:</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onClientConnected</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">removeClientError</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;<br><code>unsigned int* <var class="pdparam">removeClientError</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55346880"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the connected client.</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>ID of the channel the client has joined.</p></li><li><p><em class="parameter"><code>removeClientError</code></em></p><p>If the pointer value is <em class="structfield"><code>ERROR_ok</code></em> (default), this client will connect normally to the virtual server. To prevent the client connecting, set the pointer value to any valid error (see the header <code class="filename">public_errors.h</code>):
    </p><pre class="programlisting">*removeClientError = ERROR_client_insufficient_permissions;</pre><p>If you do not want to block the client, it's best to not modify the <em class="parameter"><code>removeClientError</code></em> parameter at all and leave the default value of <em class="structfield"><code>ERROR_ok</code></em>.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>A client has disconnected:</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onClientDisconnected</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55364560"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the disconnected client.</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>ID of the channel the client has left.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>A client has moved into another channel:</p><a name="s_onclientmoved"></a><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onClientMoved</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">oldChannelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">newChannelID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>uint64 <var class="pdparam">oldChannelID</var></code>;<br><code>uint64 <var class="pdparam">newChannelID</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55378144"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the moved client.</p></li><li><p><em class="parameter"><code>oldChannelID</code></em></p><p>ID of the old channel the client has left.</p></li><li><p><em class="parameter"><code>newChannelID</code></em></p><p>ID of the new channel the client has joined.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>A channel has been created:</p><a name="s_onchannelcreated"></a><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onChannelCreated</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">invokerClientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">invokerClientID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55392608"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>invokerClientID</code></em></p><p>ID of the invoker who created the channel (client or server ID).</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>ID of the created channel.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>A channel has been edited:</p><a name="s_onchanneledited"></a><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onChannelEdited</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">invokerClientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">invokerClientID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55405392"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>invokerClientID</code></em></p><p>ID of the invoker who edited the channel (client or server ID).</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>ID of the edited channel.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>A channel has been deleted:</p><a name="s_onchanneldeleted"></a><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onChannelDeleted</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">invokerClientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">invokerClientID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55418176"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>invokerClientID</code></em></p><p>ID of the invoker who deleted the channel (client or server ID).</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>ID of the deleted channel.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>Text messages can be received on the server side. Only server and channel chats trigger this event, client-to-client messages are not caught for privacy reasons.</p><p>Server chat messages can be intercepted with:</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onServerTextMessageEvent</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">invokerClientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">textMessage</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">invokerClientID</var></code>;<br><code>const char* <var class="pdparam">textMessage</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55431024"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>invokerClientID</code></em></p><p>ID of the client who sent the text message.</p></li><li><p><em class="parameter"><code>textMessage</code></em></p><p>Message text</p></li></ul></div><p>Channel chat messages can be intercepted with:</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onChannelTextMessageEvent</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">invokerClientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">targetChannelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">textMessage</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">invokerClientID</var></code>;<br><code>uint64 <var class="pdparam">targetChannelID</var></code>;<br><code>const char* <var class="pdparam">textMessage</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55443248"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server.</p></li><li><p><em class="parameter"><code>invokerClientID</code></em></p><p>ID of the client who sent the text message.</p></li><li><p><em class="parameter"><code>targetChannelID</code></em></p><p>ID of the channel in which the text message was sent.</p></li><li><p><em class="parameter"><code>textMessage</code></em></p><p>Message text</p></li></ul></div><div class="literallayout"><p><br>
</p></div><a name="s_userloggingevent"></a><p>If user-defined logging was enabled when initialzing the Server Lib by passing <em class="structfield"><code>LogType_USERLOGGING</code></em> to the <em class="parameter"><code>usedLogTypes</code></em> parameter of <a class="link" href="ar01s04.html" title="Initializing"><code class="function">ts3server_initServerLib</code></a>, log messages will be sent to the following callback, which allows user customizable logging and handling or critical errors:</p><a class="indexterm" name="idp55455904"></a><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onUserLoggingMessageEvent</b>(</code></td><td><var class="pdparam">logMessage</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">logLevel</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">logChannel</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">logID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">logTime</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">completeLogString</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>const char* <var class="pdparam">logMessage</var></code>;<br><code>int <var class="pdparam">logLevel</var></code>;<br><code>const char* <var class="pdparam">logChannel</var></code>;<br><code>uint64 <var class="pdparam">logID</var></code>;<br><code>const char* <var class="pdparam">logTime</var></code>;<br><code>const char* <var class="pdparam">completeLogString</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55463840"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>logMessage</code></em></p><p>Actual log message text.</p></li><li><p><em class="parameter"><code>logLevel</code></em></p><p>Severity of log message, defined by the enum <span class="structname">LogLevel</span>.</p><a class="indexterm" name="idp55468880"></a><a name="s_loglevelenum"></a><pre class="programlisting">enum LogLevel {
    LogLevel_CRITICAL = 0, //these messages stop the program
    LogLevel_ERROR,        //everything that is really bad, but not so bad we need to shut down
    LogLevel_WARNING,      //everything that *might* be bad
    LogLevel_DEBUG,        //output that might help find a problem
    LogLevel_INFO,         //informational output, like "starting database version x.y.z"
    LogLevel_DEVEL         //developer only output (will not be displayed in release mode)
};</pre><p>Note that only log messages of a level higher than the one configured with <a class="link" href="ar01s14.html#s_setlogverb"><code class="function">ts3server_setLogVerbosity</code></a> will appear.</p></li><li><p><em class="parameter"><code>logChannel</code></em></p><p>Optional custom text to categorize the message channel.</p></li><li><p><em class="parameter"><code>logID</code></em></p><p>Virtual server ID identifying the current virtual server when using multiple connections.</p></li><li><p><em class="parameter"><code>logTime</code></em></p><p>String with date and time when the log message occured.</p></li><li><p><em class="parameter"><code>completeLogString</code></em></p><p>Provides a verbose log message including all previous parameters for convinience.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>A client connected to this server starts or stops talking:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onClientStartTalkingEvent</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="idp55485088"></a>
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onClientStopTalkingEvent</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="idp55489504"></a>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>The ID of the server which sent the event.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the client who starts or stops talking</p></li></ul></div><p>
</p><div class="literallayout"><p><br>
</p></div><p>
  If required, the raw voice data can be caught by the server to implement server-side voice recording. Whenever a client is sending voice data, the following function is called:</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onVoiceDataEvent</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">voiceData</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">voiceDataSize</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">frequency</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>unsigned char* <var class="pdparam">voiceData</var></code>;<br><code>unsigned int <var class="pdparam">voiceDataSize</var></code>;<br><code>unsigned int <var class="pdparam">frequency</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp55502032"></a><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>The ID of the server which sent the event.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the client who sent the voice data.</p></li><li><p><em class="parameter"><code>voiceData</code></em></p><p>Buffer containing the voice data. Format is 16 bit mono.</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>The buffer must not be freed.</p></td></tr></table></div></li><li><p><em class="parameter"><code>voiceDataSize</code></em></p><p>Size of the <em class="parameter"><code>voiceData</code></em> buffer.</p></li><li><p><em class="parameter"><code>frequency</code></em></p><p>Frequency of the voice data.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This event is always fired, even if the client is the only user in a channel. So clients &#8220;<span class="quote">talking to themselves</span>&#8221; will also be recorded.</p></td></tr></table></div><p>If server-side recording is not required, don't implement this callback.</p><div class="literallayout"><p><br>
</p></div><p>
  The following event is called when a license error occurs, like for example missing license file, expired license, starting too many virtual servers etc. Instead of shutting down the whole process by throwing a critical error in the Server Lib, this callback allows you to handle the issue gracefully and keep your application running.
  </p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">void <b class="fsfunc">onAccountingErrorEvent</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">errorCode</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>unsigned int <var class="pdparam">errorCode</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
  <a class="indexterm" name="idp55519920"></a>
  <a class="indexterm" name="idp55520928"></a>
  </p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>The ID of the virtual server on which the license error occured. This virtual server will be automatically shutdown, other virtual servers keep running.</p><p>If <em class="parameter"><code>serverID</code></em> is zero, all virtual servers are affected and have been shutdown. In this case you might want to call <a class="link" href="ar01s06.html" title="Shutting down"><code class="function">ts3server_destroyServerLib</code></a> to clean up resources.</p></li><li><p><em class="parameter"><code>errorCode</code></em></p><p>Code of the occured error. Use <a class="link" href="ar01s07.html" title="Error handling"><code class="function">ts3server_getGlobalErrorMessage</code></a> to convert to a message string.</p></li></ul></div><p>
</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s11.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s12s01.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Channel and client manipulation </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> Custom encryption</td></tr></table></div></body></html>
