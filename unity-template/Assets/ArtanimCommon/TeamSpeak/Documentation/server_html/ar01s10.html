<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Retrieve and store information</title><link rel="stylesheet" href="ts3doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="up" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="prev" href="ar01s09s02.html" title="Alternative way to create virtual servers"><link rel="next" href="ar01s10s02.html" title="Channel information"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><img id="logo" src="images/logo.png"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Retrieve and store information</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s09s02.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s10s02.html"><img src="images/next.png" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="s_storedinfo"></a>Retrieve and store information</h2></div></div></div><p>The Server Lib stores various pieces of information, which is made available to the custom server. This chapter covers how to query and store data in the Server Lib.</p><p>All strings passed to and from the Server Lib need to be encoded in UTF-8 format.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="s_clientinfo"></a>Client information</h3></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="s_clientinfoget"></a>Query client information</h4></div></div></div><p>Information about the clients currently connected to this virtual server can be retrieved and modified. To query client related information, use one of the following functions. The client is identified by the parameter <em class="parameter"><code>clientID</code></em>. The parameter <em class="parameter"><code>flag</code></em> is defined by the enum <span class="structname">ClientProperties</span>.</p><p>
  </p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_getClientVariableAsInt</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">flag</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">result</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>ClientProperties <var class="pdparam">flag</var></code>;<br><code>int* <var class="pdparam">result</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
  <a class="indexterm" name="idp54865680"></a>
</p><p>
  </p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_getClientVariableAsString</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">flag</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">result</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>ClientProperties <var class="pdparam">flag</var></code>;<br><code>char** <var class="pdparam">result</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
  <a class="indexterm" name="idp54872240"></a>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>The ID of the virtual server on which the client property is queried.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the client whose property is queried.</p></li><li><p><em class="parameter"><code>flag</code></em></p><p>Client propery to query, see below.</p></li><li><p><em class="parameter"><code>result</code></em></p><p>Address of a variable that receives the result value as int or string, depending on which function is used. In case of a string, memory must be released using <a class="link" href="ar01s14.html#freememory"><code class="function">ts3server_freeMemory</code></a>, unless an error occured.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>. For the string version: If an error has occured, the result string is uninitialized and must not be released.</p><p>The parameter <em class="parameter"><code>flag</code></em> specifies the type of queried information. It is defined by the enum <span class="structname">ClientProperties</span><a class="indexterm" name="idp54885264"></a>:</p><pre class="programlisting">enum ClientProperties {
 CLIENT_UNIQUE_IDENTIFIER = 0,    //automatically up-to-date for any client "in view", can be used
                                  //to identify this particular client installation
  CLIENT_NICKNAME,                //automatically up-to-date for any client "in view"
  CLIENT_VERSION,                 //for other clients than ourself, this needs to be requested
                                  //(=&gt; requestClientVariables)
  CLIENT_PLATFORM,                //for other clients than ourself, this needs to be requested
                                  //(=&gt; requestClientVariables)
  CLIENT_FLAG_TALKING,            //automatically up-to-date for any client that can be heard
                                  //(in room / whisper)
  CLIENT_INPUT_MUTED,             //automatically up-to-date for any client "in view", this clients
                                  //microphone mute status
  CLIENT_OUTPUT_MUTED,            //automatically up-to-date for any client "in view", this clients
                                  //headphones/speakers mute status
  CLIENT_OUTPUTONLY_MUTED         //automatically up-to-date for any client "in view", this clients
                                  //headphones/speakers only mute status
  CLIENT_INPUT_HARDWARE,          //automatically up-to-date for any client "in view", this clients
                                  //microphone hardware status (is the capture device opened?)
  CLIENT_OUTPUT_HARDWARE,         //automatically up-to-date for any client "in view", this clients
                                  //headphone/speakers hardware status (is the playback device opened?)
  CLIENT_INPUT_DEACTIVATED,       //only usable for ourself, not propagated to the network
  CLIENT_IDLE_TIME,               //internal use
  CLIENT_DEFAULT_CHANNEL,         //only usable for ourself, the default channel we used to connect
                                  //on our last connection attempt
  CLIENT_DEFAULT_CHANNEL_PASSWORD,//internal use
  CLIENT_SERVER_PASSWORD,         //internal use
  CLIENT_META_DATA,               //automatically up-to-date for any client "in view", not used by
                                  //TeamSpeak, free storage for sdk users
  CLIENT_IS_MUTED,                //only make sense on the client side locally, "1" if this client is
                                  //currently muted by us, "0" if he is not
  CLIENT_IS_RECORDING,            //automatically up-to-date for any client "in view"
  CLIENT_VOLUME_MODIFICATOR,      //internal use
  CLIENT_VERSION_SIGN,			  //internal use
  CLIENT_SECURITY_HASH,           //SDK only: Hash is provided by an outside source. A channel will
                                  //use the security salt + other client data to calculate a hash,
								  //which must be the same as the one provided here.
  CLIENT_ENDMARKER,
};</pre><div class="itemizedlist"><ul type="disc"><li><p><em class="structfield"><code>CLIENT_UNIQUE_IDENTIFIER</code></em></p><p>String: Unique ID for this client. Stays the same after restarting the application, so you can use this to identify individual users.</p></li><li><p><em class="structfield"><code>CLIENT_NICKNAME</code></em></p><p>Nickname used by the client</p></li><li><p><em class="structfield"><code>CLIENT_VERSION</code></em></p><p>Application version used by this client.</p></li><li><p><em class="structfield"><code>CLIENT_PLATFORM</code></em></p><p>Operating system used by this client.</p></li><li><p><em class="structfield"><code>CLIENT_FLAG_TALKING</code></em></p><p>Set when the client is currently talking. Always available for visible clients.</p></li><li><p><em class="structfield"><code>CLIENT_INPUT_MUTED</code></em></p><p>Indicates the mute status of the clients capture device. Possible values are defined by the enum <span class="structname">MuteInputStatus</span>.</p></li><li><p><em class="structfield"><code>CLIENT_OUTPUT_MUTED</code></em></p><p>Indicates the combined mute status of the clients playback and capture devices. Possible values are defined by the enum <span class="structname">MuteOutputStatus</span>. Always available for visible clients.</p></li><li><p><em class="structfield"><code>CLIENT_OUTPUTONLY_MUTED</code></em></p><p>Indicates the mute status of the clients playback device. Possible values are defined by the enum <span class="structname">MuteOutputStatus</span>. Always available for visible clients.</p></li><li><p><em class="structfield"><code>CLIENT_INPUT_HARDWARE</code></em></p><p>Set if the clients capture device is not available. Possible values are defined by the enum <span class="structname">HardwareInputStatus</span>.</p></li><li><p><em class="structfield"><code>CLIENT_OUTPUT_HARDWARE</code></em></p><p>Set if the clients playback device is not available. Possible values are defined by the enum <span class="structname">HardwareOutputStatus</span>.</p></li><li><p><em class="structfield"><code>CLIENT_INPUT_DEACTIVATED</code></em></p><p>Set when the capture device has been deactivated as used in Push-To-Talk. Possible values are defined by the enum <span class="structname">InputDeactivationStatus</span>. Only available to client, not propagated to the server.</p></li><li><p><em class="structfield"><code>CLIENT_IDLE_TIME</code></em></p><p>Time the client has been idle.</p></li><li><p><em class="structfield"><code>CLIENT_TYPE</code></em></p><p>Indicates if the given client is a normal TeamSpeak 3 client or a connection established by the ServerQuery application.</p></li><li><p><em class="structfield"><code>CLIENT_DEFAULT_CHANNEL</code></em></p><p><em class="structfield"><code>CLIENT_DEFAULT_CHANNEL_PASSWORD</code></em></p><p>Default channel name and password used in the last <code class="function">ts3server_startConnection</code> call. Only available for own client.</p></li><li><p><em class="structfield"><code>CLIENT_META_DATA</code></em></p><p>Not used by TeamSpeak 3, offers free storage for SDK users.</p></li><li><p><em class="structfield"><code>CLIENT_IS_MUTED</code></em></p><p>Indicates a client has been locally muted with <code class="function">ts3server_requestMuteClients</code>. Client-side only.</p></li><li><p><em class="structfield"><code>CLIENT_IS_RECORDING</code></em></p><p>Indicates a client is currently recording all voice data in his channel.</p></li><li><p><em class="structfield"><code>CLIENT_VOLUME_MODIFICATOR</code></em></p><p>The client volume modifier set by <code class="function">ts3client_setClientVolumeModifier</code>.</p></li><li><p><em class="structfield"><code>CLIENT_SECURITY_HASH</code></em></p><p>Contains client security hash (optional feature). This hash is used to check if this client is allowed to enter specified channels with a matching <em class="structfield"><code>CHANNEL_SECURITY_SALT</code></em>. Motivation is to enforce clients joining a server with the specific identity, nickname and metadata.</p><p>Please see <a class="link" href="ar01s13.html" title="Security salts and hashes">Security salts and hashes</a> for details.</p></li></ul></div><div class="literallayout"><p><br>
</p></div><p>Generally all types of information can be retrieved as both string or integer. However, in most cases the expected data type is obvious, like querying <em class="structfield"><code>CLIENT_NICKNAME</code></em> will clearly require to store the result as string.</p><p>Example: Query nickname of client with ID 123:</p><pre class="programlisting">unsigned int error;
anyID clientID = 123;  /* Client ID in our example */
char* nickname;

if((error = ts3server_getClientVariableAsString(serverID, clientID, CLIENT_NICKNAME, &amp;nickname)) != ERROR_ok) {
    printf("Error querying client nickname: %d\n", error);
    return;
}

printf("Client nickname is: %s\n", nickname);
ts3server_freeMemory(nickname);</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="s_clientinfoset"></a>Setting client information</h4></div></div></div><p>Client information can be modified with</p><p>
  </p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_setClientVariableAsInt</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">flag</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">value</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>ClientProperties <var class="pdparam">flag</var></code>;<br><code>int <var class="pdparam">value</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
  <a class="indexterm" name="idp54932192"></a>
</p><p>
  </p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_setClientVariableAsString</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">flag</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">value</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;<br><code>ClientProperties <var class="pdparam">flag</var></code>;<br><code>const char* <var class="pdparam">value</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
  <a class="indexterm" name="idp54938752"></a>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server on which the client property should be changed.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>ID of the client whose property should be changed.</p></li><li><p><em class="parameter"><code>flag</code></em></p><p>Client propery to query, see above.</p></li><li><p><em class="parameter"><code>value</code></em></p><p>Value the client property should be changed to.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>After modifying one or more client variables, you <span class="emphasis"><em>must</em></span> flush the changes.</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_flushClientVariable</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clientID</var></code>;</div><div class="funcprototype-spacer"> </div></div><a class="indexterm" name="idp54953472"></a></td></tr></table></div><p>The idea behind flushing is, one can modify multiple values by calling <code class="function">ts3server_setClientVariableAsString</code> and <code class="function">ts3server_setClientVariableAsInt</code> and then apply all changes in one step.</p><p>For example, to change the nickname of the client with ID 55 to &#8220;<span class="quote">Joe</span>&#8221;:</p><pre class="programlisting">anyID clientID = 55;  /* Client ID in our example */

/* Modifiy data */
if(ts3server_setClientVariableAsString(serverID, clientID, CLIENT_NICKNAME, "Joe") != ERROR_ok) {
    printf("Error setting client nickname\n");
    return;
}

/* Flush changes
if(ts3server_flushClientVariable(serverID, clientID) != ERROR_ok) {
    printf("Error flushing client variable\n");
}</pre><p>Example for applying two changes:</p><pre class="programlisting">anyID clientID = 66;  /* Client ID in our example */

/* Modify data 1 */
if(ts3server_setClientVariableAsInt(scHandlerID, clientID, CLIENT_AWAY, AWAY_ZZZ) != ERROR_ok) {
    printf("Error setting away mode\n");
    return;
}

/* Modify data 2 */
if(ts3server_setClientVariableAsString(scHandlerID, clientID, CLIENT_AWAY_MESSAGE, "Lunch") != ERROR_ok) {
    printf("Error setting away message\n");
    return;
}

/* Flush changes */
if(ts3server_flushClientVariable(scHandlerID, clientID) != ERROR_ok) {
    printf("Error flushing client variable");
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="s_whisper"></a>Whisper lists</h4></div></div></div><p>A client with a whisper list set can talk to the specified clients and channels. Whisper lists can be defined for individual clients. A whisper list consists of an array of client IDs and/or an array of channel IDs.
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_setClientWhisperList</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>anyID <var class="pdparam">clID</var></code>;<br><code>const uint64* <var class="pdparam">channelID</var></code>;<br><code>const anyID* <var class="pdparam">clientID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="idp54966848"></a></p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server on which the whisper list is set.</p></li><li><p><em class="parameter"><code>clID</code></em></p><p>ID of the client whose whisper list is set.</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>NULL-terminated array of channel IDs. These channels will be added to the clients whisper list.</p><p>Pass NULL for an empty list.</p></li><li><p><em class="parameter"><code>clientID</code></em></p><p>NULL-termianted array of client IDs. These clients will be added to the clients whisper list.</p><p>Pass NULL for an empty list.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s09s02.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s10s02.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Alternative way to create virtual servers </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> Channel information</td></tr></table></div></body></html>
