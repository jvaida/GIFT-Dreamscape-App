<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Create and stop virtual servers</title><link rel="stylesheet" href="ts3doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="up" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="prev" href="ar01s08.html" title="Query virtual servers, clients and channels"><link rel="next" href="ar01s09s02.html" title="Alternative way to create virtual servers"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><img id="logo" src="images/logo.png"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Create and stop virtual servers</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s08.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s09s02.html"><img src="images/next.png" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="s_addstartstop"></a>Create and stop virtual servers</h2></div></div></div><p>A new virtual server can be created within the current server process by calling:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_createVirtualServer</b>(</code></td><td><var class="pdparam">serverPort</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">serverIp</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">serverName</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">serverKeyPair</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">serverMaxClients</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">result</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>unsigned int <var class="pdparam">serverPort</var></code>;<br><code>const char* <var class="pdparam">serverIp</var></code>;<br><code>const char* <var class="pdparam">serverName</var></code>;<br><code>const char* <var class="pdparam">serverKeyPair</var></code>;<br><code>unsigned int <var class="pdparam">serverMaxClients</var></code>;<br><code>uint64* <var class="pdparam">result</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="idp54642624"></a></p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverPort</code></em></p><p>UDP port to be used for the new virtual server. The default TeamSpeak 3 port is UDP 9987.</p></li><li><p><em class="parameter"><code>serverIp</code></em></p><p>Comma seperated list of IP addresses to bind the virtual server to. Both IPv4 and IPv6 IPs are supported. Pass &#8220;<span class="quote">0.0.0.0, ::</span>&#8221; to bind the virtual server to all IP addresses.</p></li><li><p><em class="parameter"><code>serverName</code></em></p><p>Name of the new virtual server. This can be later accessed through the virtual server property <a class="link" href="ar01s10s03.html#s_serverinfoget" title="Query server information"><em class="structfield"><code>VIRTUALSERVER_NAME</code></em></a>.</p></li><li><p><em class="parameter"><code>serverKeyPair</code></em></p><p>Unique keypair of this server. The first time you start this virtual server, pass an empty string, query the keypair with <code class="function">ts3server_getVirtualServerKeyPair</code>, then save the keypair locally and pass it the next time as parameter to this function.</p></li><li><p><em class="parameter"><code>serverMaxClients</code></em></p><p>Maximum number of clients (&#8220;<span class="quote">slots</span>&#8221;) which can simultaneously be connected to this virtual server.</p></li><li><p><em class="parameter"><code>result</code></em></p><p>Address of a variable which receives the ID of the created virtual server.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>. On success, the created virtual server will be automatically started.</p><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>You should <span class="emphasis"><em>not</em></span> create a virtual server with an empty keypair except than the first time. If the server should crash, license problems might result when using &#8220;<span class="quote">throw-away</span>&#8221; keypairs, as the license systems might consider you are running more virtual servers than you actually do.</p><p>Instead query the keypair the first time the virtual server was started, save it to a file and reuse it when creating a new virtual server. This way licensing issues will not occur.</p><p>See the server sample which is included in the TeamSpeak 3 SDK for an example on how to save and restore keypairs.</p></td></tr></table></div><div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png"></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>When a virtual server is started, it will register itself at a TeamSpeak licensing server reporting the maximal client count to ensure the server is operating within the license limits. On shutdown, the virtual server will unregister at the licensing server.</p><p>This leads to two important things to keep in mind:</p><p>1) Don't just kill your server with Ctrl-C, instead ensure it's shutdown properly calling <code class="function">ts3server_stopVirtualServer</code>. If killed too often, the licensing server might reject this server instance because the license seems to be exceeded as client slots are only added but never removed.</p><p>2) Don't start a virtual server too frequently. This may raise an error <span class="emphasis"><em>&#8220;<span class="quote">virtualserver started too many times in a certain time period</span>&#8221;</em></span>. Contacting the licensing server will be prevented to protect our backend services from getting spammed with frequent server updates for the same server.</p><p>The trigger conditions for this error are very specific and are as follows:
  </p><div class="itemizedlist"><ul type="disc"><li><p>You start a server instance and then stop the same instance within 5 seconds of it being started.</p></li><li><p>The above happens more than 3 times in a 41 minute window.</p></li></ul></div><p>After you triggered this error, you will be prevented from starting any server instance using the affected license for a period of 12 minutes.</p><p>You should first investigate how you managed to trigger this error and change your scripts to avoid triggering the conditions above. Then you must not start any server instance for the 12 minute grace period mentioned above. After this wait, you should be able to start your instance normally.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The TeamSpeak 3 server uses UDP. Support for TCP might be added in the future.</p></td></tr></table></div><div class="literallayout"><p><br>
</p></div><p>To query the keypair of a virtual server, use:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_getVirtualServerKeyPair</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">result</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>char** <var class="pdparam">result</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="idp54674432"></a></p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server for which the keypair is queried.</p></li><li><p><em class="parameter"><code>result</code></em></p><p>Address of a variable that receives a string with the keypair of this virtual server. Save the keypair and pass it the next time this virtual server is created as parameter to <code class="function">ts3server_createVirtualServer</code>.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>. If an error has occured, the result string is uninitialized and must not be released.</p><div class="literallayout"><p><br>
</p></div><p>A virtual server can be stopped with:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_stopVirtualServer</b>(</code></td><td><var class="pdparam">serverID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
<a class="indexterm" name="idp54685616"></a></p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server that should be stopped.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><div class="literallayout"><p><br>
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s08.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s09s02.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Query virtual servers, clients and channels </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> Alternative way to create virtual servers</td></tr></table></div></body></html>
